<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyAI - AI-Powered Study Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-flip {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .card-flip.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .calendar-day:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
            transition: all 0.2s ease;
        }
        
        .calendar-day.today {
            background: #10B981;
            color: white;
        }
        
        .calendar-day.selected {
            background: #F59E0B;
            color: white;
        }
        
        .calendar-day.has-tasks::after {
            content: 'üìù';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3B82F6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-green-500">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div id="toast-icon" class="w-5 h-5 text-green-500">‚úì</div>
                </div>
                <div class="ml-3">
                    <p id="toast-message" class="text-sm font-medium text-gray-900">Success!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-md mx-4 fade-in">
            <div class="text-center mb-6">
                <div class="text-4xl mb-2">üß†</div>
                <h1 class="text-2xl font-bold text-gray-900">StudyAI</h1>
                <p class="text-gray-600">Your AI-powered study assistant</p>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="space-y-4">
                <h2 class="text-xl font-semibold text-center">Login</h2>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your password">
                </div>
                <button onclick="handleLogin()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">Login</button>
                <div class="text-center">
                    <button onclick="showSignupForm()" class="text-blue-500 hover:text-blue-600 text-sm">Don't have an account? Sign up</button>
                </div>
                <div class="text-center">
                    <button onclick="handleSkipAuth()" class="text-gray-500 hover:text-gray-600 text-sm">Skip for now (Guest Mode)</button>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="space-y-4 hidden">
                <h2 class="text-xl font-semibold text-center">Sign Up</h2>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="signupName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="signupEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="signupPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your password">
                </div>
                <button onclick="handleSignup()" class="w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors">Sign Up</button>
                <div class="text-center">
                    <button onclick="showLoginForm()" class="text-blue-500 hover:text-blue-600 text-sm">Already have an account? Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white py-4 px-6 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl">üß†</div>
                    <h1 class="text-2xl font-bold">StudyAI</h1>
                </div>
                <div id="userInfo" class="flex items-center space-x-4">
                    <span id="userName" class="text-sm"></span>
                    <button onclick="handleLogout()" class="bg-white bg-opacity-20 px-3 py-1 rounded-lg hover:bg-opacity-30 transition-colors text-sm">Sign Out</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="text-center py-12">
                <div class="text-6xl mb-4">üéì</div>
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Welcome to StudyAI!</h2>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto">Transform your study notes into interactive flashcards, get AI-powered summaries, and organize your learning with our smart study planner.</p>
                <button onclick="startStudying()" class="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors text-lg font-semibold">Start Studying</button>
            </div>

            <!-- Study Interface -->
            <div id="studyInterface" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Note Input Section -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">üìù Your Notes</h3>
                        <textarea id="noteInput" class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" placeholder="Paste your study notes here..."></textarea>
                        
                        <div class="grid grid-cols-2 gap-3 mt-4">
                            <button onclick="generateFlashcards()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2">
                                <span>üÉè</span>
                                <span>Generate Flashcards</span>
                            </button>
                            <button onclick="makeConcise()" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center space-x-2">
                                <span>üìù</span>
                                <span>Make Concise</span>
                            </button>
                            <button onclick="addDetails()" class="bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition-colors flex items-center justify-center space-x-2">
                                <span>‚ûï</span>
                                <span>Add Details</span>
                            </button>
                            <button onclick="openStudyPlanner()" class="bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors flex items-center justify-center space-x-2">
                                <span>üìÖ</span>
                                <span>Study Planner</span>
                            </button>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">‚ú® AI Results</h3>
                        <div id="resultsContainer" class="space-y-4">
                            <div class="text-center text-gray-500 py-8">
                                <div class="text-4xl mb-2">ü§ñ</div>
                                <p>Your AI-processed content will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Flashcards Section -->
                <div id="flashcardsSection" class="hidden mt-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">üÉè Interactive Flashcards</h3>
                            <div class="flex items-center space-x-4">
                                <span id="cardCounter" class="text-sm text-gray-600">Card 1 of 5</span>
                                <button onclick="shuffleCards()" class="bg-gray-500 text-white px-3 py-1 rounded-lg hover:bg-gray-600 transition-colors text-sm">Shuffle</button>
                            </div>
                        </div>
                        <div id="flashcardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Flashcards will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Study Planner Section -->
                <div id="studyPlannerSection" class="hidden mt-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">üìÖ Study Planner</h3>
                            <button onclick="closeStudyPlanner()" class="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Calendar -->
                            <div class="lg:col-span-2">
                                <div class="flex justify-between items-center mb-4">
                                    <button onclick="previousMonth()" class="p-2 hover:bg-gray-100 rounded-lg">‚Äπ</button>
                                    <h4 id="currentMonth" class="text-lg font-semibold">January 2024</h4>
                                    <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg">‚Ä∫</button>
                                </div>
                                <div id="calendar" class="grid grid-cols-7 gap-1">
                                    <!-- Calendar will be generated here -->
                                </div>
                            </div>
                            
                            <!-- Task Management -->
                            <div>
                                <h4 class="text-lg font-semibold mb-4">Tasks for <span id="selectedDateText">Today</span></h4>
                                
                                <!-- Add Task Form -->
                                <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                                    <input type="text" id="taskTitle" placeholder="Task title" class="w-full p-2 border border-gray-300 rounded-lg mb-2">
                                    <select id="taskPriority" class="w-full p-2 border border-gray-300 rounded-lg mb-2">
                                        <option value="low">Low Priority</option>
                                        <option value="medium">Medium Priority</option>
                                        <option value="high">High Priority</option>
                                    </select>
                                    <input type="date" id="taskDueDate" class="w-full p-2 border border-gray-300 rounded-lg mb-2">
                                    <button onclick="addTask()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">Add Task</button>
                                </div>
                                
                                <!-- Task List -->
                                <div id="taskList" class="space-y-2">
                                    <!-- Tasks will be generated here -->
                                </div>
                                
                                <!-- Progress Stats -->
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h5 class="font-semibold mb-2">Progress</h5>
                                    <div class="space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span>Total: <span id="totalTasks">0</span></span>
                                            <span>Completed: <span id="completedTasks">0</span></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div id="progressBar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="hidden fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Processing with AI...</p>
        </div>
    </div>

    <script>
        // App State
        const appState = {
            currentUser: null,
            users: [],
            tasks: [],
            currentDate: new Date(),
            selectedDate: new Date(),
            flashcards: [],
            currentCardIndex: 0
        };

        // Sample biology notes
        const sampleNotes = `Photosynthesis is the process by which plants convert light energy into chemical energy. This process occurs in the chloroplasts of plant cells, specifically in structures called thylakoids. The process can be divided into two main stages: the light-dependent reactions and the Calvin cycle.

Light-dependent reactions take place in the thylakoid membranes and require sunlight. During these reactions, chlorophyll and other pigments absorb light energy, which is used to split water molecules (H2O) into oxygen (O2), hydrogen ions (H+), and electrons. This process is called photolysis. The electrons are then passed through an electron transport chain, creating ATP (adenosine triphosphate) and NADPH (nicotinamide adenine dinucleotide phosphate).

The Calvin cycle, also known as the light-independent reactions, occurs in the stroma of the chloroplasts. This cycle uses the ATP and NADPH produced in the light-dependent reactions to convert carbon dioxide (CO2) from the atmosphere into glucose (C6H12O6). The Calvin cycle consists of three main phases: carbon fixation, reduction, and regeneration of the starting molecule.

The overall equation for photosynthesis is: 6CO2 + 6H2O + light energy ‚Üí C6H12O6 + 6O2. This process is crucial for life on Earth as it produces oxygen and forms the base of most food chains.`;

        // Initialize App
        function initApp() {
            loadData();
            if (appState.currentUser) {
                showMainApp();
            } else {
                showAuthModal();
            }
        }

        // Data Persistence
        function saveData() {
            try {
                localStorage.setItem('studyAI_users', JSON.stringify(appState.users));
                localStorage.setItem('studyAI_currentUser', JSON.stringify(appState.currentUser));
                localStorage.setItem('studyAI_tasks', JSON.stringify(appState.tasks));
            } catch (error) {
                showToast('Error saving data', 'error');
            }
        }

        function loadData() {
            try {
                appState.users = JSON.parse(localStorage.getItem('studyAI_users')) || [];
                appState.currentUser = JSON.parse(localStorage.getItem('studyAI_currentUser'));
                appState.tasks = JSON.parse(localStorage.getItem('studyAI_tasks')) || [];
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Authentication Functions
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            const user = appState.users.find(u => u.email === email && u.password === password);
            if (user) {
                appState.currentUser = user;
                saveData();
                showMainApp();
                showToast('Welcome back!', 'success');
            } else {
                showToast('Invalid credentials', 'error');
            }
        }

        function handleSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (!name || !email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            if (appState.users.find(u => u.email === email)) {
                showToast('Email already exists', 'error');
                return;
            }
            
            const newUser = { id: Date.now(), name, email, password };
            appState.users.push(newUser);
            appState.currentUser = newUser;
            saveData();
            showMainApp();
            showToast('Account created successfully!', 'success');
        }

        function handleSkipAuth() {
            appState.currentUser = { id: 'guest', name: 'Guest User', email: 'guest@studyai.com' };
            showMainApp();
            showToast('Welcome! You are in guest mode', 'success');
        }

        function handleLogout() {
            appState.currentUser = null;
            saveData();
            showAuthModal();
            showToast('Logged out successfully', 'success');
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }

        function showSignupForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }

        // UI Management
        function showAuthModal() {
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userName').textContent = appState.currentUser.name;
        }

        function showWelcomeScreen() {
            document.getElementById('welcomeScreen').classList.remove('hidden');
            document.getElementById('studyInterface').classList.add('hidden');
        }

        function startStudying() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('studyInterface').classList.remove('hidden');
            document.getElementById('noteInput').value = sampleNotes;
        }

        function showLoadingScreen() {
            document.getElementById('loadingScreen').classList.remove('hidden');
        }

        function hideLoadingScreen() {
            document.getElementById('loadingScreen').classList.add('hidden');
        }

        // AI Integration
        async function callGeminiAPI(prompt) {
            // Note: In production, store API key securely
            const API_KEY = 'AIzaSyBkCPscBeMhwVGKXs07dy7vnLnXkOUmBso';
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                throw error;
            }
        }

        async function generateFlashcardsWithAI(notes) {
            const prompt = `Create 5 interactive flashcards from these study notes. Format each card as:
Q: [Question]
A: [Answer]

Notes: ${notes}`;
            
            const response = await callGeminiAPI(prompt);
            return parseFlashcards(response);
        }

        async function processNotesWithAI(notes, action) {
            let prompt;
            switch (action) {
                case 'concise':
                    prompt = `Summarize these study notes into key points and main concepts. Make it concise but comprehensive: ${notes}`;
                    break;
                case 'details':
                    prompt = `Expand these study notes with additional explanations, examples, and context. Make it more detailed and educational: ${notes}`;
                    break;
                default:
                    return notes;
            }
            
            return await callGeminiAPI(prompt);
        }

        function parseFlashcards(text) {
            const cards = [];
            const cardRegex = /Q:\s*(.+?)\s*A:\s*(.+?)(?=Q:|$)/gs;
            let match;
            
            while ((match = cardRegex.exec(text)) !== null) {
                cards.push({
                    question: match[1].trim(),
                    answer: match[2].trim()
                });
            }
            
            return cards;
        }

        // AI Action Functions
        async function generateFlashcards() {
            const notes = document.getElementById('noteInput').value;
            if (!notes.trim()) {
                showToast('Please enter some notes first', 'error');
                return;
            }
            
            showLoadingScreen();
            try {
                appState.flashcards = await generateFlashcardsWithAI(notes);
                displayFlashcards();
                showToast('Flashcards generated successfully!', 'success');
            } catch (error) {
                showToast('Error generating flashcards', 'error');
            } finally {
                hideLoadingScreen();
            }
        }

        async function makeConcise() {
            const notes = document.getElementById('noteInput').value;
            if (!notes.trim()) {
                showToast('Please enter some notes first', 'error');
                return;
            }
            
            showLoadingScreen();
            try {
                const result = await processNotesWithAI(notes, 'concise');
                displayResult('üìù Concise Summary', result);
                showToast('Notes summarized successfully!', 'success');
            } catch (error) {
                showToast('Error processing notes', 'error');
            } finally {
                hideLoadingScreen();
            }
        }

        async function addDetails() {
            const notes = document.getElementById('noteInput').value;
            if (!notes.trim()) {
                showToast('Please enter some notes first', 'error');
                return;
            }
            
            showLoadingScreen();
            try {
                const result = await processNotesWithAI(notes, 'details');
                displayResult('‚ûï Detailed Notes', result);
                showToast('Notes expanded successfully!', 'success');
            } catch (error) {
                showToast('Error processing notes', 'error');
            } finally {
                hideLoadingScreen();
            }
        }

        function displayResult(title, content) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-900 mb-2">${title}</h4>
                    <div class="text-gray-700 whitespace-pre-wrap">${content}</div>
                </div>
            `;
        }

        // Flashcards Functions
        function displayFlashcards() {
            const container = document.getElementById('flashcardsContainer');
            const section = document.getElementById('flashcardsSection');
            
            container.innerHTML = '';
            appState.currentCardIndex = 0;
            
            appState.flashcards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card-flip cursor-pointer bg-white rounded-lg shadow-md p-6 h-48 relative';
                cardElement.onclick = () => flipFlashcard(index);
                
                cardElement.innerHTML = `
                    <div class="card-front absolute inset-0 p-6 flex items-center justify-center text-center">
                        <div>
                            <div class="text-sm text-gray-500 mb-2">Question</div>
                            <div class="font-medium">${card.question}</div>
                        </div>
                    </div>
                    <div class="card-back absolute inset-0 p-6 flex items-center justify-center text-center">
                        <div>
                            <div class="text-sm text-gray-500 mb-2">Answer</div>
                            <div class="font-medium">${card.answer}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(cardElement);
            });
            
            section.classList.remove('hidden');
            updateCardCounter();
        }

        function flipFlashcard(index) {
            const card = document.querySelectorAll('.card-flip')[index];
            card.classList.toggle('flipped');
        }

        function shuffleCards() {
            appState.flashcards = appState.flashcards.sort(() => Math.random() - 0.5);
            displayFlashcards();
            showToast('Cards shuffled!', 'success');
        }

        function updateCardCounter() {
            document.getElementById('cardCounter').textContent = `Card ${appState.currentCardIndex + 1} of ${appState.flashcards.length}`;
        }

        // Study Planner Functions
        function openStudyPlanner() {
            document.getElementById('studyPlannerSection').classList.remove('hidden');
            renderCalendar();
            updateTaskList();
        }

        function closeStudyPlanner() {
            document.getElementById('studyPlannerSection').classList.add('hidden');
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const currentMonth = document.getElementById('currentMonth');
            
            const year = appState.currentDate.getFullYear();
            const month = appState.currentDate.getMonth();
            
            currentMonth.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            // Clear calendar
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 py-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'h-12';
                calendar.appendChild(emptyDay);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day h-12 flex items-center justify-center cursor-pointer rounded-lg relative';
                dayElement.textContent = day;
                
                const currentDate = new Date(year, month, day);
                
                // Check if it's today
                if (currentDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Check if it's selected
                if (currentDate.toDateString() === appState.selectedDate.toDateString()) {
                    dayElement.classList.add('selected');
                }
                
                // Check if it has tasks
                const hasTasks = appState.tasks.some(task => {
                    const taskDate = new Date(task.dueDate);
                    return taskDate.toDateString() === currentDate.toDateString();
                });
                
                if (hasTasks) {
                    dayElement.classList.add('has-tasks');
                }
                
                dayElement.onclick = () => selectCalendarDate(currentDate);
                calendar.appendChild(dayElement);
            }
        }

        function selectCalendarDate(date) {
            appState.selectedDate = date;
            document.getElementById('selectedDateText').textContent = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric' 
            });
            renderCalendar();
            updateTaskList();
        }

        function previousMonth() {
            appState.currentDate.setMonth(appState.currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            appState.currentDate.setMonth(appState.currentDate.getMonth() + 1);
            renderCalendar();
        }

        function addTask() {
            const title = document.getElementById('taskTitle').value;
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;
            
            if (!title || !dueDate) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            const task = {
                id: Date.now(),
                title,
                priority,
                dueDate,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            appState.tasks.push(task);
            saveData();
            updateTaskList();
            
            // Clear form
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDueDate').value = '';
            
            showToast('Task added successfully!', 'success');
        }

        function updateTaskList() {
            const taskList = document.getElementById('taskList');
            const selectedDateStr = appState.selectedDate.toISOString().split('T')[0];
            
            const dayTasks = appState.tasks.filter(task => task.dueDate === selectedDateStr);
            
            if (dayTasks.length === 0) {
                taskList.innerHTML = '<p class="text-gray-500 text-center py-4">No tasks for this day</p>';
            } else {
                taskList.innerHTML = dayTasks.map(task => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTaskCompletion(${task.id})" 
                                   class="w-4 h-4 text-blue-600 rounded">
                            <span class="${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</span>
                            <span class="px-2 py-1 text-xs rounded ${getPriorityClass(task.priority)}">${task.priority}</span>
                        </div>
                        <button onclick="deleteTask(${task.id})" class="text-red-500 hover:text-red-700">‚úï</button>
                    </div>
                `).join('');
            }
            
            updateProgressStats();
        }

        function toggleTaskCompletion(taskId) {
            const task = appState.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                updateTaskList();
            }
        }

        function deleteTask(taskId) {
            appState.tasks = appState.tasks.filter(t => t.id !== taskId);
            saveData();
            updateTaskList();
            showToast('Task deleted', 'success');
        }

        function getPriorityClass(priority) {
            switch (priority) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function updateProgressStats() {
            const selectedDateStr = appState.selectedDate.toISOString().split('T')[0];
            const dayTasks = appState.tasks.filter(task => task.dueDate === selectedDateStr);
            const completedTasks = dayTasks.filter(task => task.completed).length;
            const totalTasks = dayTasks.length;
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            
            const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            document.getElementById('progressBar').style.width = `${progressPercentage}%`;
        }

        // Notification System
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');
            
            toastMessage.textContent = message;
            
            if (type === 'error') {
                toast.querySelector('.border-l-4').className = 'border-l-4 border-red-500';
                toastIcon.textContent = '‚úï';
                toastIcon.className = 'w-5 h-5 text-red-500';
            } else {
                toast.querySelector('.border-l-4').className = 'border-l-4 border-green-500';
                toastIcon.textContent = '‚úì';
                toastIcon.className = 'w-5 h-5 text-green-500';
            }
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeStudyPlanner();
            }
        });

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

